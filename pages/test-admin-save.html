<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦ Admin ä¿å­˜åŠŸèƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ¸¬è©¦ Admin ä¿å­˜åŠŸèƒ½</h1>
    <p>é€™å€‹é é¢æ¨¡æ“¬ admin é é¢çš„ä¿å­˜æµç¨‹ï¼Œæ¸¬è©¦ HTML æ–‡ä»¶ä¿å­˜åˆ° Google Sheets çš„åŠŸèƒ½ã€‚</p>
    
    <div class="test-section">
        <h2>æ¸¬è©¦ 1ï¼šç™¼é€ Hello World HTML</h2>
        <p>æ¨¡æ“¬ admin é é¢ç™¼é€å®Œæ•´çš„ HTML æ–‡ä»¶åˆ° Google Apps Script</p>
        <button id="testBtn1" onclick="testSaveHelloWorld()">ğŸš€ åŸ·è¡Œæ¸¬è©¦</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>æ¸¬è©¦ 2ï¼šç™¼é€æ¨¡æ“¬æ¯”è³½è³‡æ–™</h2>
        <p>æ¨¡æ“¬çœŸå¯¦çš„æ¯”è³½è³‡æ–™ä¿å­˜æµç¨‹</p>
        <button id="testBtn2" onclick="testSaveGameData()">ğŸš€ åŸ·è¡Œæ¸¬è©¦</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>

    <script>
        // Google Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw96zr198osWO2HIeFbKMaHaM3-WqkHcDJ1F_OmTJdulf3Euv2E9K7LrdRpMORMr5lW/exec';

        /**
         * æ¸¬è©¦ 1ï¼šç™¼é€ Hello World HTML
         */
        async function testSaveHelloWorld() {
            const btn = document.getElementById('testBtn1');
            const resultDiv = document.getElementById('result1');
            
            btn.disabled = true;
            btn.textContent = 'æ¸¬è©¦ä¸­...';
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'â³ æ­£åœ¨ç™¼é€è«‹æ±‚åˆ° Google Apps Script...';
            
            try {
                // ç”Ÿæˆå®Œæ•´çš„ HTML æ–‡ä»¶ï¼ˆæ ¼å¼èˆ‡ g89.html ä¸€è‡´ï¼‰
                const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ¸¬è©¦é é¢ - Hello World</title>
    <meta name="description" content="é€™æ˜¯ä¸€å€‹æ¸¬è©¦é é¢ï¼Œç”¨æ–¼é©—è­‰ HTML ç”Ÿæˆå’Œä¿å­˜åŠŸèƒ½">
    <meta name="keywords" content="æ¸¬è©¦, Hello World, HTML">
  
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17514530743"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17514530743');
    </script>
  
    <link rel="icon" href="../../images/favicon.ico" type="image/x-icon">
  
    <link rel="stylesheet" href="../../styles/common/game_result.css">
</head>
<body>
    <div class="container">
        <div class="match-info">
            <h2 class="match-date">2025/01/01</h2>
            <div class="venue-info">æ¸¬è©¦å ´åœ°</div>
            <div class="match-result">
                <div class="team away">
                    <div class="team-name">æ¸¬è©¦éšŠä¼A</div>
                    <div class="team-score">10</div>
                </div>
                <div class="score-divider">:</div>
                <div class="team home">
                    <div class="team-score">20</div>
                    <div class="team-name">æ¸¬è©¦éšŠä¼B</div>
                </div>
            </div>
        </div>

        <div class="ad-section" style="text-align: center; margin: 5px auto; max-width: 728px; width: 100%;">
            <ins class="adsbygoogle"
                 style="display:block;width:100%;max-width:728px;height:90px"
                 data-ad-client="ca-pub-4455508862703492"
                 data-ad-format="horizontal"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
       
        <div class="score-details"><table class="score-table"></table></div>

        <div class="games-container">
            <div class="game-section">
                <h3>Hello World æ¸¬è©¦</h3>
                <p style="text-align: center; padding: 20px; font-size: 24px;">
                    ğŸ‘‹ Hello World!<br>
                    é€™æ˜¯ä¸€å€‹æ¸¬è©¦ HTML æ–‡ä»¶<br>
                    ç”¨æ–¼é©—è­‰ç”Ÿæˆå’Œä¿å­˜åŠŸèƒ½
                </p>
            </div>
        </div>
    </div>

<script src="../../js/game_result.js"></script>
<script>
// æ¸¬è©¦æ•¸æ“š
const testMatches = [
    {set: 1, type: '01', away: 'æ¸¬è©¦é¸æ‰‹A', home: 'æ¸¬è©¦é¸æ‰‹B', firstAttack: 'away', winner: 'home'}
];

// é£²é…’åŠ æˆ
const drinkingBonus = { away: 0, home: 0 };

// é¸æ‰‹åå–®
const awayPlayers = ['æ¸¬è©¦é¸æ‰‹A'];
const homePlayers = ['æ¸¬è©¦é¸æ‰‹B'];

// åˆå§‹åŒ–
addMatchData(testMatches);
const scores = calculateFinalScore(testMatches, drinkingBonus);
updateScoreDisplay(scores);
initializeStats(awayPlayers, homePlayers);
</script>
    <!-- å»¶é²è¼‰å…¥ AdSense èˆ‡ GTM - çµ‚æ¥µæ€§èƒ½å„ªåŒ– -->
    <script>
    var adsenseID = "ca-pub-4455508862703492";
    var gtmID = "AW-17514530743";
    var googleScriptsLoaded = false;
    function loadGoogleScripts() {
        if (googleScriptsLoaded) return;
        googleScriptsLoaded = true;
        var scriptGTM = document.createElement('script');
        scriptGTM.src = 'https://www.googletagmanager.com/gtag/js?id=' + gtmID;
        scriptGTM.async = true;
        document.head.appendChild(scriptGTM);
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', gtmID);
        var scriptAd = document.createElement('script');
        scriptAd.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=' + adsenseID;
        scriptAd.async = true;
        scriptAd.crossOrigin = "anonymous";
        document.head.appendChild(scriptAd);
        scriptAd.onload = function() {
            (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: adsenseID,
                enable_page_level_ads: true,
                overlays: {bottom: false},
                anchor_ads: {enabled: true},
                vignette_ads: {enabled: false},
                multiplex_ads: {enabled: false},
                matched_content_ads: {enabled: false},
                display_ads: {enabled: false}
            });
        };
        console.log("âœ… Google Scripts å»¶é²è¼‰å…¥å®Œæˆï¼");
    }
    window.addEventListener('mousemove', loadGoogleScripts, {passive: true, once: true});
    window.addEventListener('touchstart', loadGoogleScripts, {passive: true, once: true});
    window.addEventListener('scroll', loadGoogleScripts, {passive: true, once: true});
    setTimeout(loadGoogleScripts, 4000);
    </script>
</body>
</html>`;

                // æ¨¡æ“¬ admin é é¢ç™¼é€çš„è³‡æ–™æ ¼å¼
                const testData = {
                    gameId: 'test-hello-world',
                    htmlContent: htmlContent,
                    htmlSheetName: 'test-hello-world.html',
                    awayTeam: 'æ¸¬è©¦éšŠä¼A',
                    homeTeam: 'æ¸¬è©¦éšŠä¼B',
                    selectedPlayers: {},
                    firstAttackData: {},
                    winLoseData: {},
                    bonusTeam: null,
                    scores: {
                        home: { original: 20, winBonus: 1, drinkBonus: 0, total: 21 },
                        away: { original: 10, winBonus: 0, drinkBonus: 0, total: 10 }
                    },
                    playerStats: { away: [], home: [] },
                    timestamp: new Date().toISOString()
                };

                console.log('ğŸ“¤ ç™¼é€è³‡æ–™åˆ° Google Apps Script...');
                console.log('ğŸ“„ HTML å…§å®¹é•·åº¦:', htmlContent.length, 'å­—å…ƒ');
                console.log('ğŸ“‹ HTML å·¥ä½œè¡¨åç¨±:', testData.htmlSheetName);

                // ç™¼é€ POST è«‹æ±‚ï¼ˆèˆ‡ admin-main.js ä¸­çš„æ–¹å¼å®Œå…¨ä¸€è‡´ï¼‰
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(testData)
                });

                console.log('ğŸ“¥ æ”¶åˆ°å›æ‡‰:', response.status, response.statusText);

                if (response.ok) {
                    const resultText = await response.text();
                    console.log('ğŸ“„ å›æ‡‰å…§å®¹:', resultText);

                    try {
                        const result = JSON.parse(resultText);
                        
                        if (result.status === 'success') {
                            resultDiv.className = 'result success';
                            resultDiv.textContent = `âœ… æ¸¬è©¦æˆåŠŸï¼

ğŸ“Š çµæœè©³æƒ…ï¼š
- ç‹€æ…‹: ${result.status}
- æ¯”è³½ä»£ç¢¼: ${result.gameId}
- HTML å·¥ä½œè¡¨: ${result.htmlSheetName}
- æ™‚é–“: ${result.timestamp}

ğŸ”— å·¥ä½œè¡¨ URL:
${result.htmlSheetName ? 'https://docs.google.com/spreadsheets/d/1V2hj-9R-C2GWYu6Wo-por-gNvm56vGFPjx4ELcx3XtE/edit' : ''}

${result.githubUpload ? `\nğŸ“¤ GitHub ä¸Šå‚³: ${result.githubUpload.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}` : ''}

è«‹æ‰“é–‹ Google Sheets æŸ¥çœ‹ä¿å­˜çš„ HTML å…§å®¹ï¼`;
                        } else {
                            throw new Error(result.message || 'ä¿å­˜å¤±æ•—');
                        }
                    } catch (parseError) {
                        console.error('è§£æå›æ‡‰å¤±æ•—:', parseError);
                        if (resultText.includes('success') || resultText.includes('æˆåŠŸ')) {
                            resultDiv.className = 'result success';
                            resultDiv.textContent = `âœ… æ¸¬è©¦å¯èƒ½æˆåŠŸï¼ˆç„¡æ³•è§£æ JSONï¼‰

å›æ‡‰å…§å®¹:
${resultText.substring(0, 500)}`;
                        } else {
                            throw new Error('ä¼ºæœå™¨å›æ‡‰æ ¼å¼éŒ¯èª¤ï¼š' + resultText.substring(0, 100));
                        }
                    }
                } else {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${response.statusText}\n${errorText}`);
                }

            } catch (error) {
                console.error('âŒ æ¸¬è©¦å¤±æ•—:', error);
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—ï¼

éŒ¯èª¤è¨Šæ¯:
${error.message}

è©³ç´°è³‡è¨Š:
${error.stack || error.toString()}`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ åŸ·è¡Œæ¸¬è©¦';
            }
        }

        /**
         * æ¸¬è©¦ 2ï¼šç™¼é€æ¨¡æ“¬æ¯”è³½è³‡æ–™ï¼ˆæ›´æ¥è¿‘çœŸå¯¦æƒ…æ³ï¼‰
         */
        async function testSaveGameData() {
            const btn = document.getElementById('testBtn2');
            const resultDiv = document.getElementById('result2');
            
            btn.disabled = true;
            btn.textContent = 'æ¸¬è©¦ä¸­...';
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = 'â³ æ­£åœ¨ç”Ÿæˆ HTML ä¸¦ç™¼é€è«‹æ±‚...';
            
            try {
                // æ¨¡æ“¬ admin é é¢æ”¶é›†çš„è³‡æ–™
                const mockAdminData = {
                    gameId: 'g99',
                    gameDate: '2025/01/15',
                    awayTeam: 'æ¸¬è©¦éšŠä¼A',
                    homeTeam: 'æ¸¬è©¦éšŠä¼B',
                    sets: [
                        { setNumber: 1, setType: '501 (OI/MO)', awayPlayers: ['é¸æ‰‹A1'], homePlayers: ['é¸æ‰‹B1'], firstAttack: 'away', winner: 'away' },
                        { setNumber: 2, setType: '501 (DI/DO)', awayPlayers: ['é¸æ‰‹A2'], homePlayers: ['é¸æ‰‹B2'], firstAttack: 'home', winner: 'home' },
                        // ... å…¶ä»– SET
                    ],
                    drinkingBonus: { away: 0, home: 5 }
                };

                // ç”Ÿæˆ HTMLï¼ˆé€™è£¡ç°¡åŒ–ï¼Œå¯¦éš›æ‡‰è©²ä½¿ç”¨ preview_generator.jsï¼‰
                const htmlContent = generateMockHTML(mockAdminData);

                // æ¨¡æ“¬ admin é é¢ç™¼é€çš„è³‡æ–™æ ¼å¼
                const testData = {
                    gameId: 'g99',
                    htmlContent: htmlContent,
                    htmlSheetName: 'g99.html',
                    awayTeam: 'æ¸¬è©¦éšŠä¼A',
                    homeTeam: 'æ¸¬è©¦éšŠä¼B',
                    selectedPlayers: {
                        'away-1': ['é¸æ‰‹A1'],
                        'home-1': ['é¸æ‰‹B1'],
                        'away-2': ['é¸æ‰‹A2'],
                        'home-2': ['é¸æ‰‹B2']
                    },
                    firstAttackData: { 1: 'away', 2: 'home' },
                    winLoseData: { 1: 'away', 2: 'home' },
                    bonusTeam: 'home',
                    scores: {
                        home: { original: 15, winBonus: 1, drinkBonus: 5, total: 21 },
                        away: { original: 10, winBonus: 0, drinkBonus: 0, total: 10 }
                    },
                    playerStats: { away: [], home: [] },
                    timestamp: new Date().toISOString()
                };

                console.log('ğŸ“¤ ç™¼é€æ¯”è³½è³‡æ–™åˆ° Google Apps Script...');
                console.log('ğŸ“„ HTML å…§å®¹é•·åº¦:', htmlContent.length, 'å­—å…ƒ');

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    const resultText = await response.text();
                    const result = JSON.parse(resultText);
                    
                    if (result.status === 'success') {
                        resultDiv.className = 'result success';
                        resultDiv.textContent = `âœ… æ¸¬è©¦æˆåŠŸï¼

ğŸ“Š çµæœè©³æƒ…ï¼š
- ç‹€æ…‹: ${result.status}
- æ¯”è³½ä»£ç¢¼: ${result.gameId}
- HTML å·¥ä½œè¡¨: ${result.htmlSheetName}
- æ™‚é–“: ${result.timestamp}

ğŸ”— å·¥ä½œè¡¨ URL:
https://docs.google.com/spreadsheets/d/1V2hj-9R-C2GWYu6Wo-por-gNvm56vGFPjx4ELcx3XtE/edit`;
                    } else {
                        throw new Error(result.message || 'ä¿å­˜å¤±æ•—');
                    }
                } else {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

            } catch (error) {
                console.error('âŒ æ¸¬è©¦å¤±æ•—:', error);
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—ï¼

éŒ¯èª¤è¨Šæ¯:
${error.message}`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ åŸ·è¡Œæ¸¬è©¦';
            }
        }

        /**
         * ç”Ÿæˆæ¨¡æ“¬ HTMLï¼ˆç°¡åŒ–ç‰ˆï¼‰
         */
        function generateMockHTML(adminData) {
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ¸¬è©¦æ¯”è³½ ${adminData.gameId}</title>
    <link rel="stylesheet" href="../../styles/common/game_result.css">
</head>
<body>
    <div class="container">
        <div class="match-info">
            <h2 class="match-date">${adminData.gameDate}</h2>
            <div class="venue-info">æ¸¬è©¦å ´åœ°</div>
            <div class="match-result">
                <div class="team away">
                    <div class="team-name">${adminData.awayTeam}</div>
                    <div class="team-score">10</div>
                </div>
                <div class="score-divider">:</div>
                <div class="team home">
                    <div class="team-score">21</div>
                    <div class="team-name">${adminData.homeTeam}</div>
                </div>
            </div>
        </div>
        <div class="games-container">
            <div class="game-section">
                <h3>æ¸¬è©¦æ¯”è³½è³‡æ–™</h3>
                <p>é€™æ˜¯ä¸€å€‹æ¨¡æ“¬çš„æ¯”è³½è³‡æ–™æ¸¬è©¦</p>
            </div>
        </div>
    </div>
</body>
</html>`;
        }
    </script>
</body>
</html>
