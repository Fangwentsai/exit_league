<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>第五屆排名 | 難找的聯賽</title>
    
    <!-- GTM 已移至延遲載入腳本（body 底部） -->
    
    <!-- Event snippet for 網頁瀏覽 (1) conversion page -->
    <script>
    function gtag_report_conversion(url) {
      var callback = function () {
        if (typeof(url) != 'undefined') {
          window.location = url;
        }
      };
      gtag('event', 'conversion', {
          'send_to': 'AW-17514530743/PWRNCNSo5ZAbELePyp9B',
          'event_callback': callback
      });
      return false;
    }
    </script>
    
    <link rel="stylesheet" href="../styles/rank.css">
    <script>
        const seasonOverride = 's5';
        console.log('設置 seasonOverride =', seasonOverride);
    </script>
</head>
<body>
    <div class="container">
        <h2 class="rank-title">隊伍排名</h2>
        <div class="rank-table-container">
            <table class="rank-table" id="rankTable">
                <thead>
                    <tr class="header-row">
                        <th>排名</th>
                        <th>隊伍</th>
                        <th>勝</th>
                        <th>敗</th>
                        <th>和</th>
                        <th>積分</th>
                        <th>飲酒加成</th>
                        <th>總分</th>
                    </tr>
                </thead>
                <tbody id="rankTableBody">
                    <!-- 排名數據會在這裡動態生成 -->
                </tbody>
            </table>
        </div>

        <div class="personal-rank-header">
            <h2 class="rank-title">個人排名</h2>
            <div class="filter-container">
                <div class="team-filter">
                    <select id="teamFilter" class="team-select">
                        <option value="">所有隊伍</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" id="nameSearch" placeholder="搜尋..." class="search-input">
                </div>
                <button id="resetFilter" class="reset-button">取消</button>
            </div>
        </div>

        <div class="rank-table-container">
            <table class="rank-table" id="personalTable">
                <thead>
                    <tr class="header-row">
                        <th>排名</th>
                        <th class="sortable" data-column="team">隊伍</th>
                        <th class="sortable" data-column="name">姓名</th>
                        <th class="sortable" data-column="wins01">01勝場</th>
                        <th class="sortable" data-column="rate01">01勝率</th>
                        <th class="sortable" data-column="winsCR">CR勝場</th>
                        <th class="sortable" data-column="rateCR">CR勝率</th>
                        <th class="sortable" data-column="totalWins">總勝場</th>
                        <th class="sortable" data-column="totalRate">總勝率</th>
                        <th class="sortable" data-column="firstRate">先攻率</th>
                    </tr>
                </thead>
                <tbody id="personalTableBody">
                    <!-- 個人排名數據會在這裡動態生成 -->
                </tbody>
            </table>
            
            <!-- 添加分頁控制 -->
            <div class="pagination-container">
                <button id="prevPage" class="pagination-button">上一頁</button>
                <span id="pageInfo">第 <span id="currentPage">1</span> 頁，共 <span id="totalPages">1</span> 頁</span>
                <button id="nextPage" class="pagination-button">下一頁</button>
            </div>
        </div>
    </div>

    <!-- 確保路徑正確 -->
    <script src="../config/config.js"></script>
    <script src="../js/rank.js"></script>
    
    <!-- 延遲載入 GTM - 終極性能優化 -->
    <script>
    var gtmID = "AW-17514530743";
    var googleScriptsLoaded = false;
    
    function loadGoogleScripts() {
        if (googleScriptsLoaded) return;
        googleScriptsLoaded = true;
        
        var scriptGTM = document.createElement('script');
        scriptGTM.src = 'https://www.googletagmanager.com/gtag/js?id=' + gtmID;
        scriptGTM.async = true;
        document.head.appendChild(scriptGTM);
        
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', gtmID);
        
        console.log("✅ GTM 延遲載入完成！");
    }
    
    // 觸發條件：使用者互動時載入
    window.addEventListener('mousemove', loadGoogleScripts, {passive: true, once: true});
    window.addEventListener('touchstart', loadGoogleScripts, {passive: true, once: true});
    window.addEventListener('scroll', loadGoogleScripts, {passive: true, once: true});
    
    // 保險機制：4 秒後自動載入
    setTimeout(loadGoogleScripts, 4000);
    </script>
</body>
</html>
