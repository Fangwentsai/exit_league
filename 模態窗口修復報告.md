# 模態窗口滾動位置修復報告

## 🔴 問題描述

用戶點擊 playoffs.png 打開季後賽模態窗口後，**網頁起始點變到非常下面**。

## 🔍 問題診斷

### 根本原因

當使用 `document.body.style.overflow='hidden'` 來防止背景滾動時，會導致以下問題：

```javascript
// 原本的實現 ❌
onclick="document.getElementById('playoffsModal').classList.add('visible'); 
         document.body.style.overflow='hidden';"
```

**問題流程**：

1. 用戶在頁面中間位置（例如滾動到 500px）
2. 點擊 playoffs 圖片
3. 執行 `overflow='hidden'` → **瀏覽器隱藏滾動條**
4. 隱藏滾動條時，瀏覽器會重新計算頁面高度
5. 頁面可能跳到頂部或底部
6. 關閉模態窗口後，頁面位置已經改變 ❌

### 為什麼會這樣？

**CSS 的 `overflow: hidden` 行為**：

```css
body {
    overflow: hidden; /* 隱藏滾動條 */
}
```

當滾動條被隱藏時：
- 瀏覽器會移除滾動條（通常寬度 15-17px）
- 頁面寬度增加（因為滾動條消失了）
- 可能觸發 reflow
- 滾動位置可能丟失

---

## ✅ 解決方案

### 核心策略：固定 body 位置而非隱藏 overflow

```javascript
// 新的實現 ✅
function openPlayoffsModal() {
    // 1. 保存當前滾動位置
    scrollPosition = window.pageYOffset;
    
    // 2. 固定 body 位置
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollPosition}px`;
    document.body.style.width = '100%';
    
    // 3. 顯示模態窗口
    modal.classList.add('visible');
}

function closePlayoffsModal() {
    // 1. 隱藏模態窗口
    modal.classList.remove('visible');
    
    // 2. 恢復 body 樣式
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    
    // 3. 恢復滾動位置
    window.scrollTo(0, scrollPosition);
}
```

### 工作原理

#### 打開模態窗口時

```javascript
// 假設用戶滾動到 500px
scrollPosition = 500;

// 固定 body 在當前位置
document.body.style.position = 'fixed';
document.body.style.top = '-500px';  // 向上移動 500px
```

**效果**：
- ✅ 背景內容不會滾動
- ✅ 視覺上保持在原位置
- ✅ 不會跳動

#### 關閉模態窗口時

```javascript
// 恢復 body 樣式
document.body.style.position = '';

// 滾動回原位置
window.scrollTo(0, 500);
```

**效果**：
- ✅ 頁面回到原本的滾動位置
- ✅ 用戶體驗流暢

---

## 📊 修改對比

### 修改前 ❌

```html
<!-- 點擊事件直接內嵌 -->
<img onclick="document.getElementById('playoffsModal').classList.add('visible'); 
              document.body.style.overflow='hidden';">

<!-- 模態窗口關閉 -->
<div onclick="this.classList.remove('visible'); 
              document.body.style.overflow='';">
    <button onclick="document.getElementById('playoffsModal').classList.remove('visible'); 
                     document.body.style.overflow='';"></button>
</div>
```

**問題**：
- ❌ 使用 `overflow='hidden'`
- ❌ 沒有保存滾動位置
- ❌ 頁面會跳動

### 修改後 ✅

```html
<!-- 使用函數處理 -->
<img onclick="openPlayoffsModal();">

<!-- 模態窗口關閉 -->
<div onclick="if(event.target === this) { closePlayoffsModal(); }">
    <button onclick="closePlayoffsModal(); event.stopPropagation();">✕</button>
</div>
```

```javascript
// JavaScript 函數
let scrollPosition = 0;

function openPlayoffsModal() {
    scrollPosition = window.pageYOffset;
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollPosition}px`;
    document.body.style.width = '100%';
    modal.classList.add('visible');
}

function closePlayoffsModal() {
    modal.classList.remove('visible');
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    window.scrollTo(0, scrollPosition);
}
```

**優點**：
- ✅ 固定 body 位置
- ✅ 保存並恢復滾動位置
- ✅ 無頁面跳動

---

## 🎯 預期效果

### 打開模態窗口

```
1. 用戶在頁面中間（例如 Y = 500px）
2. 點擊 playoffs.png
3. 背景固定在當前位置 ✅
4. 模態窗口淡入顯示 ✅
5. 頁面沒有跳動 ✅
```

### 關閉模態窗口

```
1. 用戶點擊關閉按鈕或按 ESC
2. 模態窗口淡出 ✅
3. 背景解除固定 ✅
4. 滾動回原位置（Y = 500px）✅
5. 用戶繼續從原位置閱讀 ✅
```

---

## 🧪 測試步驟

### 1. 測試基本功能

```
步驟：
1. 打開 news.html
2. 滾動到頁面中間
3. 點擊 playoffs.png
4. ✅ 檢查：頁面沒有跳到頂部或底部
5. ✅ 檢查：模態窗口正確顯示
6. 點擊關閉按鈕（✕）
7. ✅ 檢查：頁面回到原本的位置
```

### 2. 測試不同關閉方式

```
方式 1：點擊關閉按鈕
- 點擊右上角的 ✕
- ✅ 應該正常關閉並恢復位置

方式 2：點擊背景
- 點擊模態窗口外的灰色背景
- ✅ 應該正常關閉並恢復位置

方式 3：按 ESC 鍵
- 按鍵盤 ESC
- ✅ 應該正常關閉並恢復位置
```

### 3. 測試不同滾動位置

```
測試 1：在頁面頂部
- 滾動到頂部（Y = 0）
- 打開模態窗口
- ✅ 應該保持在頂部

測試 2：在頁面中間
- 滾動到中間（Y = 500px）
- 打開模態窗口
- ✅ 應該保持在中間位置

測試 3：在頁面底部
- 滾動到底部
- 打開模態窗口
- ✅ 應該保持在底部
```

---

## 📚 技術細節

### 為什麼使用 `position: fixed`？

```css
body {
    position: fixed;  /* 固定位置 */
    top: -500px;      /* 向上偏移（模擬滾動）*/
    width: 100%;      /* 保持寬度 */
}
```

**優點**：
1. ✅ **完全防止滾動**：背景無法滾動
2. ✅ **保持視覺位置**：使用負 `top` 值模擬滾動
3. ✅ **不影響寬度**：設定 `width: 100%` 防止寬度改變
4. ✅ **可精確控制**：可以準確恢復位置

**vs `overflow: hidden`**：

| 特性 | `overflow: hidden` | `position: fixed` |
|------|-------------------|-------------------|
| 防止滾動 | ✅ | ✅ |
| 保持位置 | ❌ | ✅ |
| 防止跳動 | ❌ | ✅ |
| 寬度穩定 | ❌ | ✅ |

### 滾動位置計算

```javascript
// 獲取當前滾動位置（跨瀏覽器兼容）
scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

// pageYOffset：現代瀏覽器
// document.documentElement.scrollTop：舊版瀏覽器
```

### 恢復滾動位置

```javascript
// 使用 scrollTo 精確定位
window.scrollTo(0, scrollPosition);

// 也可以使用 scrollTo 的物件參數（更現代）
window.scrollTo({
    top: scrollPosition,
    behavior: 'instant'  // 立即跳轉，不要平滑滾動
});
```

---

## 🎓 最佳實踐

### 1. 模態窗口的正確實現

```javascript
// ✅ 標準模式
function openModal() {
    // 1. 保存狀態
    scrollPosition = window.pageYOffset;
    
    // 2. 固定背景
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollPosition}px`;
    document.body.style.width = '100%';
    
    // 3. 顯示模態窗口
    modal.classList.add('visible');
}

function closeModal() {
    // 1. 隱藏模態窗口
    modal.classList.remove('visible');
    
    // 2. 恢復背景
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    
    // 3. 恢復位置
    window.scrollTo(0, scrollPosition);
}
```

### 2. 事件處理

```html
<!-- ✅ 使用函數，便於管理 -->
<img onclick="openModal()">

<!-- ✅ 點擊背景關閉 -->
<div onclick="if(event.target === this) closeModal()">

<!-- ✅ 關閉按鈕阻止冒泡 -->
<button onclick="closeModal(); event.stopPropagation();">
```

### 3. 鍵盤支持

```javascript
// ✅ ESC 鍵關閉
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        if (modal.classList.contains('visible')) {
            closeModal();
        }
    }
});
```

---

## 🐛 常見問題

### Q1: 為什麼需要 `width: 100%`？

**A**: 當 `position: fixed` 時，元素會脫離文檔流，寬度可能變成 `auto`。設定 `width: 100%` 確保 body 保持全寬。

### Q2: 移動裝置上會有問題嗎？

**A**: 不會。這個方案在移動裝置上同樣有效，甚至更重要，因為移動裝置的滾動行為更複雜。

### Q3: 如果頁面很長，會影響性能嗎？

**A**: 不會。只是設定 CSS 屬性和記錄數字，性能影響微乎其微。

### Q4: 能否使用 CSS 的 `scroll-behavior: smooth`？

**A**: 關閉模態窗口時，應該立即恢復位置，不要使用平滑滾動：

```javascript
// ❌ 不要這樣
document.documentElement.style.scrollBehavior = 'smooth';
window.scrollTo(0, scrollPosition);

// ✅ 應該這樣（立即跳轉）
window.scrollTo(0, scrollPosition);
```

---

## ✅ 完成狀態

| 項目 | 狀態 |
|------|------|
| 修復頁面跳動問題 | ✅ 完成 |
| 實現滾動位置保存 | ✅ 完成 |
| 實現滾動位置恢復 | ✅ 完成 |
| 支援多種關閉方式 | ✅ 完成 |
| ESC 鍵支援 | ✅ 完成 |

---

## 🎊 總結

### 核心改進

1. **從 `overflow: hidden` 改為 `position: fixed`**
   - 完全防止頁面跳動
   - 精確控制滾動位置

2. **保存和恢復滾動位置**
   - 打開模態窗口前保存
   - 關閉模態窗口後恢復

3. **統一的函數處理**
   - `openPlayoffsModal()`
   - `closePlayoffsModal()`
   - 便於維護和除錯

### 用戶體驗提升

- ✅ 無頁面跳動
- ✅ 流暢的開關動畫
- ✅ 位置完美恢復
- ✅ 符合用戶預期

---

**修復日期**：2025/12/01  
**影響頁面**：pages/news.html  
**測試狀態**：等待用戶驗證  
**預期結果**：模態窗口打開/關閉時，頁面位置不變

